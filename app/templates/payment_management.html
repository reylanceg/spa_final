{% extends 'base.html' %} {% block content %}
<div class="cashier-payment-page">
  <!-- Compact Header -->
  <div class="cashier-payment-header">
    <div class="header-left">
      <a href="/cashier" class="back-to-cashier-link" id="back_to_cashier_link">
        <button class="back-to-cashier-button">‚Üê Back to Queue</button>
      </a>
    </div>
    <div class="header-center">
      <!-- <h2 class="page-title">Payment Terminal</h2> -->
    </div>
    <div class="header-right">
      <div class="counter-badge-compact">
        <span class="counter-label">Counter</span>
        <span class="counter-number" id="counter_display">{{ counter_number or '1' }}</span>
      </div>
    </div>
  </div>

  <!-- Professional Payment Interface -->
  <div class="cashier-payment-container">
    <div class="payment-interface-card">
      <div id="current_payment_txn">
        <!-- Default content when no transaction -->
        <div class="no-active-payment">
          <div class="payment-status-display">
            <div class="status-icon">üí≥</div>
            <h3>Payment Terminal Ready</h3>
            <p>No active transaction</p>
          </div>
          <div class="quick-actions">
            <button class="action-btn primary" onclick="returnToQueue()">Return to Queue</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Hidden inputs for functionality -->
  <input type="hidden" id="cashier_name" value="{{ cashier_name or '' }}" />
  <input type="hidden" id="counter_number" value="{{ counter_number or '' }}" />
</div>
<script>
  // Set token in sessionStorage, handle None/undefined cases
  const tokenFromServer = '{{token}}';
  console.log('Token from server:', tokenFromServer);
  
  if (tokenFromServer && tokenFromServer !== 'None' && tokenFromServer !== 'undefined') {
    sessionStorage.setItem('cashier_auth_token', tokenFromServer);
    console.log('Token stored in sessionStorage');
  } else {
    console.warn('No valid token received from server');
  }
  
  function returnToQueue() {
    const token = sessionStorage.getItem('cashier_auth_token');
    console.log('returnToQueue - token:', token ? 'present' : 'missing');
    
    const redirectUrl = token && token !== 'None' && token !== 'undefined'
      ? `/cashier?auth_token=${encodeURIComponent(token)}`
      : '/cashier';
    
    console.log('Redirecting to:', redirectUrl);
    window.location.href = redirectUrl;
  }
</script>
<script src="/static/js/payment_management.js"></script>
{% endblock %}

{% extends 'base.html' %} {% block content %}
<div class="therapist-page-container">
  <div class="controls">
    <div id="room_number" class="therapist-room-number">
      Room {{room_number}} {{therapist_name}}
    </div>
    <!-- <label
    >Name
    <input
      id="therapist_name"
      placeholder="Therapist 1"
      value="{{ therapist_name or '' }}"
  /></label> -->
    <!-- <div id="therapist_name">
      <p>{{therapist_name}}</p>
    </div> -->
    <!-- <label
    >Room
    <input id="room_number" placeholder="101" value="{{ room_number or '' }}"
    /></label> -->
    <div class="controls-container">
      <div id="therapist_name" hidden>
        <p>{{therapist_name}}</p>
      </div>
      
      <button id="confirm_next" class="therapist-confirm-button">
        Confirm FIFO
      </button>
      <button id="toggle_room_status" class="therapist-confirm-button toggle-status-button" data-status="available">
        On Break
      </button>
      <button class="therapist-confirm-button service-management-button" id="service_management_btn" onclick="navigateToServiceManagement()">
        Service Management
      </button>
    </div>
    <a href="/logout/therapist" onclick="sessionStorage.removeItem('therapist_auth_token');" class="logout">Logout</a>
  </div>
  <div class="therapist-pending-services-container">
    <section class="therapist-pending-services">
      <div class="therapist-pending-services-header">
        <h3>Waiting Queue</h3>
        <h3 class="pending-service-header-code">Code</h3>
      </div>
      <ul id="waiting_queue"></ul>
    </section>
    <section class="therapist-history-section">
      <div class="therapist-history-header">
        <h3>Service History</h3>
        <button id="toggle_history" class="toggle-history-button">Show History</button>
      </div>
      <div id="history_container" class="history-container" style="display: none;">
        <ul id="finished_transactions"></ul>
      </div>
    </section>
  </div>
</div>
<script>
  sessionStorage.setItem('therapist_auth_token', '{{token}}')
  
  function navigateToServiceManagement() {
    const token = sessionStorage.getItem('therapist_auth_token');
    console.log('Navigate to service management, token:', token ? 'present' : 'missing');
    
    const redirectUrl = token 
      ? `/therapist/service-management?auth_token=${encodeURIComponent(token)}`
      : '/therapist/service-management';
    
    console.log('Redirecting to:', redirectUrl);
    window.location.href = redirectUrl;
  }
</script>
<script src="/static/js/therapist_queue.js"></script>
{% endblock %}

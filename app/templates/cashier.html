{% extends 'base.html' %} {% block content %}
<div class="cashier-page-container">
  <div class="controls">
    <div id="counter_number" class="cashier-counter-badge">
      COUNTER {{counter_number}}
    </div>
    <div id="cashier_name" hidden>
      <p>{{cashier_name}}</p>
    </div>
    <div class="controls-container">
      <button id="pick_next" class="cashier-confirm-button">
        CONFIRM (FIFO)
      </button>
      <button class="cashier-payment-link" id="payment_management_btn">Payment Management</button>
    </div>
    <a
      href="/logout/cashier"
      onclick="sessionStorage.removeItem('cashier_auth_token');"
      class="logout"
      >Logout</a
    >
  </div>
  <div class="cashier-pending-services-container">
    <section class="cashier-pending-services">
      <div class="cashier-pending-header">
        <h3>Waiting Queue</h3>
        <h3 style="margin-right: 20px">Code</h3>
      </div>
      <ul id="cashier_waiting"></ul>
    </section>
    <section class="cashier-history-section">
      <div class="cashier-history-header">
        <h3>Payment History</h3>
        <button id="toggle_payment_history" class="toggle-history-button">Show History</button>
      </div>
      <div id="payment_history_container" class="history-container" style="display: none;">
        <ul id="payment_history_list"></ul>
      </div>
    </section>
  </div>
  <!-- <div class="cashier-payment-container">
    <section class="cashier-payment-section">
      <h3>Assigned To You</h3>
      <ul id="cashier_assigned"></ul>
      <h3>Payment</h3>
      <div id="payment_panel"></div>
    </section>
  </div> -->
</div>
<script>
  // Set token in sessionStorage, handle None/undefined cases
  const tokenFromServer = '{{token}}';
  console.log('Token from server:', tokenFromServer);
  
  if (tokenFromServer && tokenFromServer !== 'None' && tokenFromServer !== 'undefined') {
    sessionStorage.setItem('cashier_auth_token', tokenFromServer);
    console.log('Token stored in sessionStorage');
  } else {
    console.warn('No valid token received from server');
  }
  
  function navigateToPaymentManagement() {
    // Wait a bit to ensure token is set
    setTimeout(() => {
      const token = sessionStorage.getItem('cashier_auth_token');
      console.log('Navigate to payment management, token:', token ? 'present' : 'missing');
      console.log('Actual token value:', token);
      console.log('Token from server was:', '{{token}}');
      
      if (!token || token === 'None' || token === 'undefined') {
        console.error('No valid token available, redirecting without token');
        alert('Authentication token not found. You may be logged out.');
      }
      
      const redirectUrl = token && token !== 'None' && token !== 'undefined'
        ? `/cashier/payment-management?auth_token=${encodeURIComponent(token)}`
        : '/cashier/payment-management';
      
      console.log('Redirecting to:', redirectUrl);
      window.location.href = redirectUrl;
    }, 100);
  }
  
  // Add event listener when DOM is ready
  document.addEventListener('DOMContentLoaded', function() {
    const paymentMgmtBtn = document.getElementById('payment_management_btn');
    if (paymentMgmtBtn) {
      paymentMgmtBtn.addEventListener('click', function(e) {
        e.preventDefault();
        navigateToPaymentManagement();
      });
      console.log('Payment management button event listener added');
    } else {
      console.error('Payment management button not found');
    }
  });
</script>
<script src="/static/js/cashier.js"></script>
{% endblock %}
